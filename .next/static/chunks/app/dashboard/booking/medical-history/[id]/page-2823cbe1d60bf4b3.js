(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{646:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2274:(e,t,a)=>{"use strict";a.d(t,{G:()=>l,j:()=>s});var r=a(4540);let s=r.wA,l=r.d4},3566:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(5155),s=a(2274);a(2115);let l=e=>{let{selectedPet:t,onSelectPet:a,showModal:l,setShowModal:i}=e,{pets:d}=(0,s.G)(e=>e.pet);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("button",{onClick:()=>i(!0),className:"w-full p-3 text-left rect-pet focus:ring-2 flex justify-between items-center ".concat(t?"text-[#1B1B1C] font-semibold":""," "),children:[(0,r.jsxs)("div",{className:" flex space-x-1 justify-center items-center",children:[(0,r.jsx)("img",{src:null==t?void 0:t.image,alt:"",className:" rounded-full w-5 h-5"}),(0,r.jsx)("span",{children:t?"".concat(t.name):"Select pet"})]}),(0,r.jsx)("span",{children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 5.3335L8.06323 10.6668L4 5.3335L12 5.3335Z",fill:"#1B1B1C"})})})]}),l&&(0,r.jsx)("div",{className:"fixed md:mx-auto md:max-w-3xl inset-0 bg-black/30 z-50 flex items-end",onClick:e=>{e.target===e.currentTarget&&i(!1)},children:(0,r.jsx)("div",{className:"bg-white w-full max-h-[80vh] rounded-t-xl overflow-hidden",children:(0,r.jsx)("div",{className:"p-8 max-h-[36rem] overflow-y-auto",children:d.map(e=>{var s;let l=(null==t?void 0:t.id)===e.id;return(0,r.jsxs)("div",{onClick:()=>{a(e),i(!1)},className:"p-4 rounded mb-3 cursor-pointer transition-colors min-h-24\n                      ".concat(l?"border-primary bg-primary/10 border":"border-gray-200 border"),children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("span",{className:"text-lg font-semibold ".concat(e.id?"text-[#3BB8AF]":"text-[#6C6C70]"),children:e.name}),e.id&&(0,r.jsxs)("span",{className:"text-gray-600",children:["â€¢ ",e.type]})]})}),e.id&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[e.gender,e.is_neutered&&" (Neutering)"," |"," ",function(e){let t=new Date(e),a=new Date,r=a.getFullYear()-t.getFullYear(),s=a.getMonth()-t.getMonth(),l=a.getDate()-t.getDate();l<0&&(s-=1,l+=new Date(a.getFullYear(),a.getMonth(),0).getDate()),s<0&&(r-=1,s+=12);let i=[];return r>0&&i.push("".concat(r," year").concat(r>1?"s":"")),s>0&&i.push("".concat(s," month").concat(s>1?"s":"")),0===r&&0===s&&i.push("".concat(l," day").concat(l>1?"s":"")),i.join(", ")}(e.birthday)," |"," "]})]},null!=(s=e.id)?s:"unregistered")})})})})]})}},4355:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},4416:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},4559:(e,t,a)=>{"use strict";a.d(t,{T:()=>r});let r=a(9509).env.BACKEND_URL||"https://zootopia.webprvw.link/api"},5169:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},5790:(e,t,a)=>{Promise.resolve().then(a.bind(a,6680))},6561:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>o,KB:()=>d,Px:()=>i,Yt:()=>l});var r=a(1990),s=a(8084);let l=(0,r.zD)("medical/fetchRecords",async(e,t)=>{try{return(await s.A.get("/medical-records")).data.map(e=>(e=>{var t;return{id:e.id,petId:e.pet_id,title:e.title,date:e.date,userDetails:e.user_details||void 0,hospitalDetails:e.hospital_details||void 0,photos:(null==(t=e.photos)?void 0:t.map(e=>({imageData:e.imageData,uploadedBy:e.uploadedBy})))||[]}})(e))}catch(e){var a,r;return t.rejectWithValue((null==(r=e.response)||null==(a=r.data)?void 0:a.error)||e.message)}}),i=(0,r.zD)("medical/createRecord",async(e,t)=>{try{return(await s.A.post("/medical-records",e)).data}catch(e){var a,r;return t.rejectWithValue((null==(r=e.response)||null==(a=r.data)?void 0:a.error)||e.message)}}),d=(0,r.zD)("medical/updateRecord",async(e,t)=>{try{let{id:t,...a}=e;return(await s.A.put("/medical-records/".concat(t),a)).data}catch(e){var a,r;return t.rejectWithValue((null==(r=e.response)||null==(a=r.data)?void 0:a.error)||e.message)}}),n=(0,r.zD)("medical/deleteRecord",async(e,t)=>{try{return await s.A.delete("/medical-records/".concat(e)),e}catch(e){var a,r;return t.rejectWithValue((null==(r=e.response)||null==(a=r.data)?void 0:a.error)||e.message)}}),o=(0,r.Z0)({name:"medical",initialState:{loading:!1,error:null,records:[]},reducers:{},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.loading=!1,e.records=t.payload}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{e.loading=!1,e.records.push(t.payload)}).addCase(i.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,(e,t)=>{e.loading=!1;let a=e.records.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.records[a]=t.payload)}).addCase(d.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,t)=>{e.loading=!1,e.records=e.records.filter(e=>e.id!==t.payload)}).addCase(n.rejected,(e,t)=>{e.loading=!1,e.error=t.payload})}}).reducer},6680:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(5155),s=a(2115),l=a(1154),i=a(5169),d=a(4355),n=a(4416),o=a(646),c=a(2274),u=a(3566),h=a(5695),m=a(6561),x=a(1990);let p=()=>{let e=(0,h.useRouter)(),t=(0,h.useParams)(),a=(0,c.j)(),{pets:p}=(0,c.G)(e=>e.pet),{records:g,loading:f,error:y}=(0,c.G)(e=>e.medical),j=t.id?parseInt(t.id,10):null,v=g.find(e=>e.id===j),[b,w]=(0,s.useState)(!1),[N,k]=(0,s.useState)(!1),[A,C]=(0,s.useState)(!1),[D,_]=(0,s.useState)(),[B,z]=(0,s.useState)(""),[R,P]=(0,s.useState)(""),[U,M]=(0,s.useState)([]),[S,E]=(0,s.useState)("User");(0,s.useEffect)(()=>{v&&(_(p.find(e=>e.id===v.petId)),z(v.userDetails||""),P(v.hospitalDetails||""),M(v.photos||[]))},[v,p]);let L=(0,s.useRef)(null),F=async()=>{if(!v||!D)return;let e={...v,petId:Number(D.id),userDetails:B,hospitalDetails:R,photos:U};try{let t=await a((0,m.KB)(e));(0,x.pH)(t),w(!1),C(!0)}catch(e){console.error("Failed to save medical record:",e),alert("Failed to save. Please try again.")}},H=U.filter(e=>"user"===e.uploadedBy),W=U.filter(e=>"hospital"===e.uploadedBy);return v?(0,r.jsxs)("div",{className:"flex flex-col min-h-screen bg-white font-sans",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsx)("button",{onClick:()=>e.back(),children:(0,r.jsx)(i.A,{size:24,className:"text-gray-800"})}),(0,r.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Medical History"}),b||"Hospital"==S?(0,r.jsx)("div",{className:"w-12"}):(0,r.jsx)("button",{onClick:()=>w(!0),className:"text-lg font-medium text-cyan-500",children:"Edit"})]}),(0,r.jsxs)("main",{className:"flex-1 py-4 space-y-6",children:[b?(0,r.jsx)("div",{className:"px-4",children:(0,r.jsx)(u.A,{onSelectPet:e=>_(e),selectedPet:D,showModal:N,setShowModal:k})}):(0,r.jsxs)("div",{className:"flex items-center space-x-3 px-4 py-3 shadow-sm",children:[D&&(0,r.jsx)("img",{src:D.image,alt:D.name,className:"w-14 h-14 rounded-full object-cover"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:null==D?void 0:D.name}),(0,r.jsx)("p",{className:"text-gray-500",children:null==D?void 0:D.breed})]})]}),!b&&(0,r.jsx)("div",{className:"px-4",children:(0,r.jsxs)("div",{className:"flex bg-gray-100 p-1 rounded-full",children:[(0,r.jsx)("button",{onClick:()=>E("User"),className:"w-1/2 py-2 text-center rounded-full text-sm font-medium transition-colors ".concat("User"===S?"bg-white shadow-sm text-gray-800":"bg-transparent text-gray-500"),children:"User"}),(0,r.jsx)("button",{onClick:()=>E("Hospital"),className:"w-1/2 py-2 text-center rounded-full text-sm font-medium transition-colors ".concat("Hospital"===S?"bg-white shadow-sm text-gray-800":"bg-transparent text-gray-500"),children:"Hospital"})]})}),(0,r.jsxs)("div",{className:"px-4",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-800 mb-2",children:"Detail"}),(0,r.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg min-h-[100px]",children:b?(0,r.jsx)("textarea",{value:"User"===S?B:R,onChange:e=>"User"===S?z(e.target.value):P(e.target.value),className:"w-full h-32 text-gray-700 bg-transparent focus:outline-none resize-none",placeholder:"User"===S?"Enter user details...":"Enter hospital details..."}):(0,r.jsx)("p",{className:"text-gray-700",children:"User"===S?B||"No user details provided.":R||"No hospital details provided."})})]}),(0,r.jsxs)("div",{className:"px-4",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-800 mb-2",children:"Photo"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[b&&"User"===S&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{var e;null==(e=L.current)||e.click()},className:"flex items-center justify-center w-full h-24 bg-gray-100 border border-dashed border-gray-300 rounded-lg",children:(0,r.jsx)(d.A,{className:"w-8 h-8 text-gray-400"})}),(0,r.jsx)("input",{type:"file",ref:L,onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){let e=new FileReader;e.onloadend=()=>{M([{imageData:e.result,uploadedBy:"user"},...U])},e.readAsDataURL(a)}},className:"hidden",accept:"image/*"})]}),("User"===S?H:W).map((e,t)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e.imageData,alt:"Medical photo ".concat(t+1),className:"w-full h-24 object-cover rounded-lg"}),b&&"User"===S&&(0,r.jsx)("button",{onClick:()=>{M(U.filter(t=>t.imageData!==e.imageData))},className:"absolute top-1 right-1 bg-black bg-opacity-50 rounded-full p-0.5",children:(0,r.jsx)(n.A,{size:14,className:"text-white"})})]},t))]})]})]}),b&&(0,r.jsx)("footer",{className:"p-4 border-t border-gray-100",children:(0,r.jsx)("button",{onClick:F,disabled:f,className:"w-full bg-cyan-500 text-white font-semibold py-4 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-gray-400 flex items-center justify-center",children:f?(0,r.jsx)(l.A,{className:"w-6 h-6 animate-spin"}):"Save"})}),A&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-8 text-center flex flex-col items-center max-w-sm mx-4",children:[(0,r.jsx)(o.A,{className:"w-16 h-16 text-green-500 mb-4"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Saved!"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Your changes have been saved successfully."}),(0,r.jsx)("button",{onClick:()=>e.push("/dashboard/booking/medical-history"),className:"w-full bg-primary text-white py-3 rounded-lg font-semibold text-lg",children:"Done"})]})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(l.A,{className:"w-8 h-8 animate-spin"})})}},8084:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(3464),s=a(7383),l=a(4559);let i=r.A.create({baseURL:l.T});i.interceptors.request.use(e=>{let t=s.A.get("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,async e=>{var t;let a=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!a._retry){a._retry=!0;try{let e=s.A.get("refresh_token");if(!e)throw Error("Missing refresh token");let t=(await r.A.post("".concat(l.T,"/auth/refresh"),{refresh_token:e})).data.token;return s.A.set("auth_token",t),a.headers.Authorization="Bearer ".concat(t),i(a)}catch(e){return console.error("Refresh token failed:",e),s.A.remove("auth_token"),s.A.remove("refresh_token"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)});let d=i},9946:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(2115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:s=24,strokeWidth:d=2,absoluteStrokeWidth:n,className:o="",children:c,iconNode:u,...h}=e;return(0,r.createElement)("svg",{ref:t,...i,width:s,height:s,stroke:a,strokeWidth:n?24*Number(d)/Number(s):d,className:l("lucide",o),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),n=(e,t)=>{let a=(0,r.forwardRef)((a,i)=>{let{className:n,...o}=a;return(0,r.createElement)(d,{ref:i,iconNode:t,className:l("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),n),...o})});return a.displayName=s(e),a}}},e=>{e.O(0,[122,540,990,441,964,358],()=>e(e.s=5790)),_N_E=e.O()}]);