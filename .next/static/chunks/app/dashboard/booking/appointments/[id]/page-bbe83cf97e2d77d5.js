(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2274:(e,t,a)=>{"use strict";a.d(t,{G:()=>n,j:()=>r});var s=a(4540);let r=s.wA,n=s.d4},3358:(e,t,a)=>{Promise.resolve().then(a.bind(a,7716))},4559:(e,t,a)=>{"use strict";a.d(t,{T:()=>s});let s=a(9509).env.BACKEND_URL||"https://zootopia.webprvw.link/api"},5169:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},7340:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]])},7716:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(5155),r=a(2115),n=a(1154),l=a(5169),i=a(7340),d=a(6874),o=a.n(d),c=a(5695),p=a(2274),m=a(8275),u=a(1990),h=a(8084),x=a(8141);function f(){var e;let t=(0,p.G)(e=>e.user.profile),[a,d]=(0,r.useState)(!1),f=(0,c.useRouter)(),g=(0,c.useParams)(),y=(0,p.j)(),b=g.id,{selectedAppointment:j,loading:N,error:v}=(0,p.G)(e=>e.appointment);(0,r.useEffect)(()=>{b&&y((0,m.cD)(b))},[b,y]),(0,r.useEffect)(()=>{(async()=>{try{let e=await h.A.get("/auth/profile"),t=await e.data.profile;y((0,x.p)(t))}catch(e){console.error("Failed to fetch user profile:",e)}})()},[y]);let w=()=>d(!1),A=async()=>{try{let e=await y((0,m.d3)(b));(0,u.pH)(e),w(),f.push("/dashboard/booking/appointments")}catch(e){console.error("Failed to cancel appointment:",e),w()}};if(N&&!j)return(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)(n.A,{className:"h-8 w-8 animate-spin text-cyan-500"})});if(v)return(0,s.jsxs)("div",{className:"p-4 pt-20 text-center text-red-500",children:["Error: ",v]});if(!j)return(0,s.jsx)("div",{className:"p-4 pt-20 text-center text-gray-500",children:"Appointment not found."});let C={booked:{text:"Confirm",color:"bg-[#0066C3]/50 text-[#0066C3]"},draft:{text:"Pending",color:"bg-[#FFF5F3]/80 text-[#FD5E2D]"}},k=C[j.status]||C.draft;return(0,s.jsxs)("div",{className:"min-h-screen bg-white font-sans pb-20",children:[(0,s.jsxs)("header",{className:"fixed top-0 z-10 w-full max-w-3xl bg-white px-4 py-4 flex items-center justify-between border-b border-[#E7E7E7]",children:[(0,s.jsx)(o(),{href:"/dashboard/booking/appointments",children:(0,s.jsx)(l.A,{className:"h-6 w-6 text-[#1B1B1C]"})}),(0,s.jsx)("h1",{className:"text-xl font-medium text-[#1B1B1C]",children:"Pet Reservation"}),(0,s.jsx)(o(),{href:"/dashboard",children:(0,s.jsx)(i.A,{className:"h-6 w-6 text-[#222222]"})})]}),(0,s.jsxs)("main",{className:"p-4 pt-20",children:[(0,s.jsx)("h2",{className:"mb-4 text-2xl font-bold text-gray-800",children:"Pet Reservation Details"}),(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between rounded-lg border border-gray-300 bg-white p-3 text-gray-700",children:[(0,s.jsxs)("span",{children:[j.date," ",j.timeSlot," ",j.time]}),(0,s.jsx)("button",{className:"rounded bg-gray-200 px-4 py-1 text-sm font-medium text-gray-700 hover:bg-gray-300",children:"Edit"})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"mb-2 text-lg font-semibold text-gray-800",children:"Member Information"}),(0,s.jsxs)("div",{className:"rounded-lg border border-gray-200 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between py-2",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Name"}),(0,s.jsx)("p",{className:"font-medium text-[#0066C3]",children:(null==t?void 0:t.firstName)||(null==t?void 0:t.email.split("@")[0])})]}),(0,s.jsxs)("div",{className:"flex justify-between py-2",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Phone"}),(0,s.jsx)("p",{className:"font-medium text-[#0066C3]",children:j.memberInfo.phoneNumber||(null==t?void 0:t.phone)||(null==t?void 0:t.email)})]})]})]}),(0,s.jsx)("div",{className:"space-y-6",children:null==(e=j.pets)?void 0:e.map((e,t)=>{var a;let r=(null==(a=e.selectedPet)?void 0:a.name)||"N/A",n=e.purposeOfVisit||"N/A";return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mr-2",children:["Pet Reservation"," ",j.pets.length>1?"(".concat(t+1,")"):""]}),(0,s.jsx)("span",{className:"rounded px-3 py-1 text-sm font-semibold ".concat(k.color),children:k.text})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-gray-200 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between py-2",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Pet Name"}),(0,s.jsx)("p",{className:"font-medium text-[#0066C3]",children:r})]}),(0,s.jsxs)("div",{className:"flex justify-between py-2",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Purpose of visit"}),(0,s.jsx)("p",{className:"font-medium text-[#0066C3]",children:n})]}),(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsx)("p",{className:"mb-1 text-gray-600",children:"Memo"}),(0,s.jsx)("textarea",{readOnly:!0,value:e.memo||"",rows:3,className:"w-full rounded-lg bg-[#EEF5FC] p-4 text-gray-700 outline-none"})]})]})]},t)})})]}),(0,s.jsx)("footer",{className:"fixed bottom-0 w-full max-w-3xl bg-white p-4",children:(0,s.jsx)("button",{onClick:()=>d(!0),className:"w-full rounded-lg bg-primary py-3 text-lg font-semibold text-white shadow-md hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75",children:N?(0,s.jsx)(n.A,{className:"mx-auto h-6 w-6 animate-spin"}):"Cancellation"})}),a&&(0,s.jsx)("div",{className:"fixed inset-0 z-20 flex items-center justify-center bg-black/50",children:(0,s.jsxs)("div",{className:"w-80 rounded-lg bg-white p-6 text-center shadow-xl",children:[(0,s.jsx)("p",{className:"mb-4 text-lg",children:"Do you want to cancel the reservation? This action cannot be recovered."}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)("button",{onClick:A,className:"rounded-lg px-6 py-2 font-semibold text-[#0066C3]",children:"OK"}),(0,s.jsx)("button",{onClick:w,className:"rounded-lg px-6 py-2 font-semibold text-gray-700",children:"Cancel"})]})]})})]})}},8084:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(3464),r=a(7383),n=a(4559);let l=s.A.create({baseURL:n.T});l.interceptors.request.use(e=>{let t=r.A.get("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t;let a=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!a._retry){a._retry=!0;try{let e=r.A.get("refresh_token");if(!e)throw Error("Missing refresh token");let t=(await s.A.post("".concat(n.T,"/auth/refresh"),{refresh_token:e})).data.token;return r.A.set("auth_token",t),a.headers.Authorization="Bearer ".concat(t),l(a)}catch(e){return console.error("Refresh token failed:",e),r.A.remove("auth_token"),r.A.remove("refresh_token"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)});let i=l},8141:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>d,ZA:()=>l,d6:()=>i,p:()=>r});let s=(0,a(1990).Z0)({name:"user",initialState:{profile:null},reducers:{setUserProfile:(e,t)=>{e.profile=t.payload},clearUserProfile:e=>{e.profile=null},updateUserEmail:(e,t)=>{e.profile&&(e.profile.email=t.payload)},updateUserPhone:(e,t)=>{e.profile&&(e.profile.phone=t.payload)}}}),{setUserProfile:r,clearUserProfile:n,updateUserEmail:l,updateUserPhone:i}=s.actions,d=s.reducer},8275:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>p,Ns:()=>l,cD:()=>i,d3:()=>c,gG:()=>d});var s=a(1990),r=a(8084);let n=e=>{var t,a,s;return{id:String(e.id),status:e.status,date:e.date.split("T")[0],time:e.time,timeSlot:e.time_slot,numberOfPets:e.number_of_pets,pets:e.pets.map(e=>{var t,a,s,r,n,l;return{selectedPet:{id:String(e.id),name:e.name,type:e.type,gender:null!=(t=e.gender)?t:"",age:null!=(a=e.age)?a:"",weight:null!=(s=e.weight)?s:"",is_neutered:null!=(r=e.is_neutered)&&r},purposeOfVisit:null!=(n=e.purposeOfVisit)?n:"",memo:null!=(l=e.memo)?l:""}}),memberInfo:{firstName:null!=(t=e.member_first_name)?t:"",lastName:null!=(a=e.member_last_name)?a:"",phoneNumber:null!=(s=e.member_phone)?s:""},agreedToPolicy:e.agreed_to_policy}},l=(0,s.zD)("appointments/fetchAppointments",async(e,t)=>{try{return(await r.A.get("/appointments")).data.map(e=>n(e))}catch(e){return t.rejectWithValue(e.message)}}),i=(0,s.zD)("appointments/fetchAppointmentById",async(e,t)=>{try{let t=await r.A.get("/appointments/".concat(e));return n(t.data)}catch(e){return t.rejectWithValue(e.message)}}),d=(0,s.zD)("appointments/createAppointment",async(e,t)=>{try{let t=await r.A.post("/appointments",e);return n(t.data)}catch(e){return t.rejectWithValue(e.message)}}),o=(0,s.zD)("appointments/updateAppointment",async(e,t)=>{try{let{id:t,...a}=e,s=await r.A.put("/appointments/".concat(t),a);return n(s.data)}catch(e){return t.rejectWithValue(e.message)}}),c=(0,s.zD)("appointments/deleteAppointment",async(e,t)=>{try{return await r.A.delete("/appointments/".concat(e)),e}catch(e){return t.rejectWithValue(e.message)}}),p=(0,s.Z0)({name:"appointment",initialState:{loading:!1,error:null,appointments:[],selectedAppointment:null},reducers:{},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.loading=!1,e.appointments=t.payload}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{e.loading=!1,e.selectedAppointment=t.payload;let a=e.appointments.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.appointments[a]=t.payload)}).addCase(i.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,(e,t)=>{e.loading=!1,e.appointments.push(t.payload)}).addCase(d.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,t)=>{e.loading=!1,e.selectedAppointment=t.payload;let a=e.appointments.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.appointments[a]=t.payload)}).addCase(o.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,t)=>{var a;e.loading=!1,e.appointments=e.appointments.filter(e=>e.id!==t.payload),(null==(a=e.selectedAppointment)?void 0:a.id)===t.payload&&(e.selectedAppointment=null)}).addCase(c.rejected,(e,t)=>{e.loading=!1,e.error=t.payload})}}).reducer}},e=>{e.O(0,[122,540,990,95,441,964,358],()=>e(e.s=3358)),_N_E=e.O()}]);